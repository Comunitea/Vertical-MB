<?xml version="1.0" encoding="UTF-8"?>
<openerp>
    <data>

        <!-- Editing behavior of sale order lines -->
        <record id="midban_sale_view_order_form" model="ir.ui.view">
            <field name="name">midban_sale_view_order_form</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale_stock.view_order_form_inherit"/>
            <field name="arch" type="xml">
                <!-- ####################################FORM VIEW MODIFICATIONS#################################### -->
                <!-- Add field price of the unit of measure -->
                <xpath expr="//field[@name='order_line']/form/group/group/field[@name='price_unit']" position="before">
                        <field name="price_udv"/>
                        
                </xpath>
                <!-- Avoid onchanges in product_uom_qty and product_uom -->
                <xpath expr="//field[@name='order_line']/form/group/group/div/field[@name='product_uom_qty']" position="replace">
                   <field name="product_uom_qty" class="oe_inline" readonly="True"/>
                </xpath>
                <xpath expr="//field[@name='order_line']/form/group/group/div/field[@name='product_uom']" position="replace">
                    <field name="product_uom" class="oe_inline oe_no_button" readonly="True"/>
                </xpath>
                <!-- Avoid onchanges in product_uos_qty and make it required ad context in product_uos to get only the domain units names-->
                <xpath expr="//field[@name='order_line']/form//field[@name='product_uos_qty']" position="replace">
                       <field name="product_uos_qty" class="oe_inline" required="1"/>
                </xpath>  
                <xpath expr="//field[@name='order_line']/form//field[@name='product_uos']" position="replace">
                       <field name="product_uos" class="oe_inline" required="1" context="{'product_id': product_id}"/>
                </xpath>
                <!-- Avoid onchange in price unit -->
                <xpath expr="//field[@name='order_line']/form/group/group/field[@name='price_unit']" position="replace">
                    <field name="price_unit"/>
                    <field name="price_udv"/>
                    <field name="do_onchange" invisible="1"/>  <!-- To control bidireccional onchanges -->
                </xpath>


                <!-- ####################################TREE VIEW MODIFICATIONS#################################### -->
                <!-- To control bidireccional onchanges -->
                 <xpath expr="//field[@name='order_line']/tree/field[@name='price_unit']" position="before">
                        <field name="do_onchange" invisible="1"/>   
                 </xpath>

                 <!-- Replace it in order to move product it after name field, because they are invisible in default view -->
                 <xpath expr="//field[@name='order_line']/tree/field[@name='product_uos_qty']" position="replace">
                 </xpath>
                 <xpath expr="//field[@name='order_line']/tree/field[@name='product_uos']" position="replace">
                 </xpath>

                 <!-- Movin help UoS fields and price UdV before of uom fields -->
                 <xpath expr="//field[@name='order_line']/tree/field[@name='name']" position="after">
                      <field name="product_uos_qty" required="1"/>  
                      <field name="product_uos" context="{'product_id': product_id}" required="1"/>
                      <field name="price_udv"/>  
                 </xpath>

                <!-- Avoid onchanges in product_uom_qty and product_uom -->
                <xpath expr="//field[@name='order_line']/tree/field[@name='product_uom_qty']" position="replace">
                      <field name="product_uom_qty" readonly="True"/>  
                 </xpath>
                 <xpath expr="//field[@name='order_line']/tree/field[@name='product_uom']" position="replace">
                      <field name="product_uom" readonly="True"/> 
                 </xpath>

            </field>
        </record>
    </data>
</openerp>
