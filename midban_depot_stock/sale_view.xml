<?xml version="1.0" encoding="UTF-8"?>

<openerp>
    <data>
         <record id="view_order_form_add_route" model="ir.ui.view">
            <field name="name">sale.order.form.add_route</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_form"/>
            <field name="arch" type="xml">
                <field name='project_id' position="after">
                    <field name="trans_route_id"/>
                    <field name="route_detail_id" domain="[('route_type', '=', 'delivery')]"/>
                </field>
                <field name='date_order' position="after">
                    <field name="date_planned"/>
                </field>
             </field>
         </record>

         <record id="view_order_tree_add_route" model="ir.ui.view">
            <field name="name">view_order_tree_add_route</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_order_tree"/>
            <field name="arch" type="xml">
                <field name='state' position="after">
                    <field name="trans_route_id"/>             
                    <field name="route_detail_id"/>             
                </field>
             </field>
         </record>

         <record id="view_quotation_tree_add_route" model="ir.ui.view">
            <field name="name">view_quotation_tree_add_route</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_quotation_tree"/>
            <field name="arch" type="xml">
                <field name='state' position="after">
                    <field name="trans_route_id"/>
                    <field name="route_detail_id"/>
                </field>
             </field>
         </record>

         <record id="view_sales_order_filter_add_route" model="ir.ui.view">
            <field name="name">sale.order.list.select.add.route</field>
            <field name="model">sale.order</field>
            <field name="inherit_id" ref="sale.view_sales_order_filter"/>
            <field name="arch" type="xml">
                <field name="partner_id" position="before">
                    <filter string="Today" name="filter_today" domain="[('date_order','&lt;=',time.strftime('%%Y-%%m-%%d 23:59:59')),('date_order','&gt;=',time.strftime('%%Y-%%m-%%d 00:00:00'))]"/>
                    <separator/>
                </field>
                <filter string="Order Month" position="after">
                    <filter string="Transport Route" context="{'group_by':'trans_route_id'}"/>
                    <filter name="groupby_detail" string="Detail Route" context="{'group_by':'route_detail_id'}"/>
                </filter>
            </field>
        </record>

        <!-- Replanning sales orders in routes -->
        <record id="view_orders_replanning_route_tree" model="ir.ui.view">
            <field name="name">view_orders_replanning_tree_add_route</field>
            <field name="model">sale.order</field>
            <field name="arch" type="xml">
                <tree string="Sale orders" editable="top" create="false" delete="false">
                    <field name="name"  readonly="True"/>
                    <field name="partner_id" readonly="True"/>
                    <field name="user_id" readonly="True"/>
                    <field name="note" readonly="True" string="Notes"/>
                    <field name="date_order" readonly="True" string="Date order"/>
                    <field name="amount_total" sum="Total Tax Included" readonly="True"/>
                    <field name="state" readonly="True" invisible="1"/>
                    <field name="route_detail_id" domain="[('route_type', '=', 'delivery')]"/>
                    <field name="detail_date" readonly="True" invisible="1"/>
                    <field name="trans_route_id" invisible="1"/>
                </tree>
            </field>
         </record>

        <record id="view_sales_order_replanning_route_filter" model="ir.ui.view">
            <field name="name">sale.order.replanning.route.filter</field>
            <field name="model">sale.order</field>
            <field name="arch" type="xml">
                <search string="Search Sales Order">
                    <field name="detail_date"/>
                    <field name="route_detail_id"/>
                    <field name="trans_route_id"/>
                    <field name="name" string="Sales Order" filter_domain="['|',('name','ilike',self),('client_order_ref','ilike',self)]"/>
                    <field name="partner_id" operator="child_of"/>
                    <field name="user_id"/>
                    <separator/>
                        <filter string="Today" name="filter_today" domain="[('route_detail_id.date','&lt;=',time.strftime('%%Y-%%m-%%d')),('route_detail_id.date','&gt;=',time.strftime('%%Y-%%m-%%d'))]"/>
                    <separator/>
                    <group expand="0" string="Group By">
                         <filter string="Transport Route" context="{'group_by':'trans_route_id'}"/>
                         <filter name="groupby_detail" string="Detail Route" context="{'group_by':'route_detail_id'}"/>
                         <filter name="partner_id" string="Customer" context="{'group_by':'partner_id'}"/>
                         <filter name="user_id" string="Comercial" context="{'group_by':'user_id_id'}"/>
                    </group>
               </search>
            </field>
        </record>

        <record id="action_replanning_order_route" model="ir.actions.act_window">
            <field name="name">Replanning orders in routes</field>
            <field name="type">ir.actions.act_window</field>
            <field name="res_model">sale.order</field>
            <field name="view_type">form</field>
            <field name="view_mode">tree,form</field>
            <field name="view_id" ref="view_orders_replanning_route_tree"/>
            <field name="search_view_id" ref="view_sales_order_replanning_route_filter"/>
            <field name="domain">[('state','in',('manual','progress'))]</field>
            <field name="context">{}</field>
            

        </record>

        <menuitem action="action_replanning_order_route" id="menu_replaning_order_route" name="Replanning Routes" sequence="9" parent="menu_stock_vehicle_route_mgmt"/>
    </data>
</openerp>
